<!DOCTYPE html>
<html lang="sl-SI">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MirSFlr</title>
  <link rel="icon" href="favicon-32x32.png">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    /* Tukaj vkljuƒçite vse CSS sloge, ki ste jih prej uporabljali */
  </style>
</head>
<body>
  <div id="bgOverlay"></div>

  <div class="theme-toggle-wrapper">
    <label class="theme-toggle">
      <input type="checkbox" id="themeToggle">
      <span class="slider"></span>
    </label>
  </div>

  <header>
    <h1>MirSFlr</h1>
    <p>A trusted validator on the Flare Network</p>
    <img id="logo" src="flare-icon.png" alt="Flare Icon">
  </header>

  <section id="roles">
    <h2>Roles in the Flare Network</h2>
    <div class="cards">
      <div class="card">
        <h4>üîí Validators</h4>
        <p>Validators maintain the Flare network, confirm transactions, create blocks, and earn rewards while keeping decentralization.</p>
        <div class="tooltip">Validator recap: secures network, confirms blocks, earns rewards.</div>
      </div>
      <div class="card">
        <h4>ü§ù Delegators</h4>
        <p>Delegators stake their FLR tokens to validators, help secure the network, and earn a share of staking rewards without running nodes.</p>
        <div class="tooltip">Delegator recap: supports validators, earns rewards.</div>
      </div>
      <div class="card">
        <h4>üì° Providers</h4>
        <p>Providers supply oracle data and services to smart contracts and dApps, integrating real-world data into Flare.</p>
        <div class="tooltip">Provider recap: supplies data for dApps.</div>
      </div>
    </div>
  </section>

  <section id="charts">
    <h2>Live Metrics</h2>
    <div class="charts-grid">
      <div class="chart-box" style="grid-column:span 2;">
        <h3>FLR Token Value (EUR)</h3>
        <p>Latest value: <strong id="latestPrice">0.027 ‚Ç¨</strong></p>
        <canvas id="tokenChart"></canvas>
        <p class="chart-desc">Daily FLR token value</p>
      </div>
      <div class="chart-box">
        <h3>Transactions (last 10 days)</h3>
        <canvas id="txChart"></canvas>
        <p class="chart-desc">Transactions count</p>
      </div>
      <div class="chart-box">
        <h3>Active Validators</h3>
        <canvas id="validatorsChart"></canvas>
        <p class="chart-desc">Active validators count</p>
      </div>
      <div class="chart-box">
        <h3>Stake Distribution</h3>
        <canvas id="stakeChart"></canvas>
        <p class="chart-desc">FLR distribution</p>
      </div>
    </div>
  </section>

  <section id="contact">
    <h2>Contact</h2>
    <p style="text-align:center;color:#d1d9e6">Email: <a href="mailto:svensekmir@gmail.com" style="color:#fff;text-decoration:underline">svensekmir@gmail.com</a></p>
  </section>

  <footer style="text-align:center; padding:2rem; color:#d1d9e6;">
    ¬© 2025 MirSFlr
  </footer>

  <script>
    // Theme toggle
    const themeCheckbox = document.getElementById('themeToggle');
    themeCheckbox.addEventListener('change', () => {
      document.body.classList.toggle('light-theme');
      localStorage.setItem('mir_theme', themeCheckbox.checked ? 'light' : 'dark');
    });
    if (localStorage.getItem('mir_theme') === 'light') {
      document.body.classList.add('light-theme');
      themeCheckbox.checked = true;
    }

    // Fetch live data
    async function fetchData() {
      try {
        const [priceRes, txRes, valRes, stakeRes] = await Promise.all([
          fetch('https://api.coingecko.com/api/v3/simple/price?ids=flare-network&vs_currencies=eur'),
          fetch('https://flare-explorer.flare.network/api/transactions'),
          fetch('https://flare-explorer.flare.network/api/validators'),
          fetch('https://flare-explorer.flare.network/api/stake')
        ]);

        const priceData = await priceRes.json();
        const txData = await txRes.json();
        const valData = await valRes.json();
        const stakeData = await stakeRes.json();

        // Update FLR price
        document.getElementById('latestPrice').textContent = `${priceData['flare-network'].eur} ‚Ç¨`;

        // Prepare data for charts
        const dates = txData.map(item => item.date);
        const txCounts = txData.map(item => item.count);
        const activeValidators = valData.map(item => item.active_count);
        const stakeDistribution = stakeData.map(item => item.amount);

        // Update charts
        updateCharts(dates, txCounts, activeValidators, stakeDistribution);
      } catch (error) {
        console.error('Error fetching data:', error);
      }
    }

    // Update charts with fetched data
    function updateCharts(dates, txCounts, activeValidators, stakeDistribution) {
      const tokenChartCtx = document.getElementById('tokenChart').getContext('2d');
      const txChartCtx = document.getElementById('txChart').getContext('2d');
      const validatorsChartCtx = document.getElementById('validatorsChart').getContext('2d');
      const stakeChartCtx = document.getElementById('stakeChart').getContext('2d');

      new Chart(tokenChartCtx, {
        type: 'line',
        data: {
          labels: dates,
          datasets: [{
            label: 'FLR (EUR)',
            data: stakeDistribution,
            borderColor: '#ff4081',
            backgroundColor: 'rgba(255,64,129,0.25)',
            fill: true,
            tension: 0.25,
            pointRadius: 4
          }]
        }
      });

      new Chart(txChartCtx, {
        type: 'bar',
        data: {
          labels: dates,
          datasets: [{
            label: 'Transactions',
            data: txCounts,
            backgroundColor: '#ffb6c1'
          }]
        }
      });

      new Chart(validatorsChartCtx, {
        type: 'line',
        data: {
          labels: dates,
          datasets: [{
            label: 'Active Validators',
            data: activeValidators,
            borderColor: '#ffd166',
            backgroundColor: 'rgba(255,209,102,0.25)',
            fill: true,
            tension: 0.3
          }]
        }
      });

      new Chart(stakeChartCtx, {
        type: 'doughnut',
        data: {
          labels: ['Validators', 'Delegators', 'Providers'],
          datasets: [{
            data: stakeDistribution,
            backgroundColor: ['#ff4081', '#ff80aa', '#ffb6c1']
          }]
        }
      });
    }

    // Initialize
    fetchData();
  </script>
</body>
</html>
